<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Max-Sum: include/PostOffice.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.9 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>include/PostOffice.h</h1><a href="_post_office_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="preprocessor">#ifndef MAXSUM_UTIL_POSTOFFICE_H</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor">#define MAXSUM_UTIL_POSTOFFICE_H</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;set&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;queue&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "DiscreteFunction.h"</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include "<a class="code" href="util__containers_8h.html" title="This file defines some utility container types required for the implementation of...">util_containers.h</a>"</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="keyword">namespace </span>maxsum
<a name="l00018"></a>00018 {
<a name="l00028"></a>00028    <span class="keyword">template</span>&lt;<span class="keyword">class</span> Sender, <span class="keyword">class</span> Receiver, <span class="keyword">class</span> Message=DiscreteFunction&gt;
<a name="l00029"></a><a class="code" href="classmaxsum_1_1_post_office.html">00029</a>    <span class="keyword">class </span><a class="code" href="classmaxsum_1_1_post_office.html" title="Class used to store and manage messages sent between factor graph nodes.">PostOffice</a>
<a name="l00030"></a>00030    {
<a name="l00031"></a>00031    <span class="keyword">public</span>:
<a name="l00032"></a>00032 
<a name="l00036"></a><a class="code" href="classmaxsum_1_1_post_office.html#2aeb8127cbe14bac2c31fa8170d9d388">00036</a>       <span class="keyword">typedef</span> <a class="code" href="classmaxsum_1_1util_1_1_ref_map.html" title="This class provides a read only wrapper around an existing map, such as that provided...">util::RefMap&lt;Receiver,Message*&gt;</a> <a class="code" href="classmaxsum_1_1util_1_1_ref_map.html" title="This class provides a read only wrapper around an existing map, such as that provided...">OutMsgMap</a>;
<a name="l00037"></a>00037 
<a name="l00041"></a><a class="code" href="classmaxsum_1_1_post_office.html#601c7b1f10db5b85d62f5e5f5d2de05e">00041</a>       <span class="keyword">typedef</span> <span class="keyword">typename</span> OutMsgMap::const_iterator <a class="code" href="classmaxsum_1_1_post_office.html#601c7b1f10db5b85d62f5e5f5d2de05e" title="Iterator type for PostOffice::OutMsgMap.">OutMsgIt</a>;
<a name="l00042"></a>00042 
<a name="l00046"></a><a class="code" href="classmaxsum_1_1_post_office.html#6d206af548f7f7e3bbce714c10afdc15">00046</a>       <span class="keyword">typedef</span> <a class="code" href="classmaxsum_1_1util_1_1_ref_map.html" title="This class provides a read only wrapper around an existing map, such as that provided...">util::RefMap&lt;Sender,Message*&gt;</a> <a class="code" href="classmaxsum_1_1util_1_1_ref_map.html" title="This class provides a read only wrapper around an existing map, such as that provided...">InMsgMap</a>;
<a name="l00047"></a>00047 
<a name="l00051"></a><a class="code" href="classmaxsum_1_1_post_office.html#d72954fbcd3627789e540146f86b0241">00051</a>       <span class="keyword">typedef</span> <span class="keyword">typename</span> InMsgMap::const_iterator <a class="code" href="classmaxsum_1_1_post_office.html#d72954fbcd3627789e540146f86b0241" title="Iterator type for PostOffice::InMsgMap.">InMsgIt</a>;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053    <span class="keyword">private</span>:
<a name="l00054"></a>00054 
<a name="l00058"></a>00058       <span class="keyword">typedef</span> std::map&lt;Receiver,Message*&gt; PrivOutMsgMap;
<a name="l00059"></a>00059 
<a name="l00063"></a>00063       <span class="keyword">typedef</span> <span class="keyword">typename</span> PrivOutMsgMap::iterator PrivOutMsgIt;
<a name="l00064"></a>00064 
<a name="l00068"></a>00068       <span class="keyword">typedef</span> std::map&lt;Sender,Message*&gt; PrivInMsgMap;
<a name="l00069"></a>00069 
<a name="l00073"></a>00073       <span class="keyword">typedef</span> <span class="keyword">typename</span> PrivInMsgMap::iterator PrivInMsgIt;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00079"></a>00079       <span class="keyword">typedef</span> std::map&lt;Sender,PrivOutMsgMap&gt; OutboxMap;
<a name="l00080"></a>00080 
<a name="l00084"></a>00084       <span class="keyword">typedef</span> std::map&lt;Receiver,PrivInMsgMap&gt; InboxMap;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086    <span class="keyword">public</span>:
<a name="l00087"></a>00087 
<a name="l00096"></a><a class="code" href="classmaxsum_1_1_post_office.html#46f69b2bd13a833b3a48a5f367c95103">00096</a>       <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="classmaxsum_1_1util_1_1_key_set_1_1const__iterator.html" title="Iterator type that allows read-only access to the keys of the underlying map.">util::KeySet&lt;OutboxMap&gt;::const_iterator</a> <a class="code" href="classmaxsum_1_1util_1_1_key_set_1_1const__iterator.html" title="Iterator type that allows read-only access to the keys of the underlying map.">SenderIt</a>;
<a name="l00097"></a>00097 
<a name="l00106"></a><a class="code" href="classmaxsum_1_1_post_office.html#0b8222b4db57fb0e840e61be409ab11c">00106</a>       <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="classmaxsum_1_1util_1_1_key_set_1_1const__iterator.html" title="Iterator type that allows read-only access to the keys of the underlying map.">util::KeySet&lt;InboxMap&gt;::const_iterator</a> <a class="code" href="classmaxsum_1_1util_1_1_key_set_1_1const__iterator.html" title="Iterator type that allows read-only access to the keys of the underlying map.">ReceiverIt</a>;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108    <span class="keyword">private</span>:
<a name="l00109"></a>00109 
<a name="l00113"></a>00113       OutboxMap curOutboxes_i;
<a name="l00114"></a>00114 
<a name="l00118"></a>00118       OutboxMap prevOutboxes_i;
<a name="l00119"></a>00119 
<a name="l00123"></a>00123       InboxMap curInboxes_i;
<a name="l00124"></a>00124 
<a name="l00128"></a>00128       InboxMap prevInboxes_i;
<a name="l00129"></a>00129 
<a name="l00133"></a>00133       <a class="code" href="classmaxsum_1_1util_1_1_key_set.html">util::KeySet&lt;OutboxMap&gt;</a> senders_i;
<a name="l00134"></a>00134 
<a name="l00138"></a>00138       <a class="code" href="classmaxsum_1_1util_1_1_key_set.html">util::KeySet&lt;InboxMap&gt;</a> receivers_i; 
<a name="l00139"></a>00139 
<a name="l00143"></a>00143       std::queue&lt;Receiver&gt; notices_i;
<a name="l00144"></a>00144 
<a name="l00145"></a>00145    <span class="keyword">public</span>:
<a name="l00146"></a>00146 
<a name="l00150"></a><a class="code" href="classmaxsum_1_1_post_office.html#7be8983a09bfef736ead7aea6d8dcb1b">00150</a>       <a class="code" href="classmaxsum_1_1_post_office.html#7be8983a09bfef736ead7aea6d8dcb1b" title="Constructs an empty PostOffice with no edges, senders or receivers.">PostOffice</a>()
<a name="l00151"></a>00151          : curOutboxes_i(), prevOutboxes_i(),
<a name="l00152"></a>00152            curInboxes_i(), prevInboxes_i(),
<a name="l00153"></a>00153            senders_i(&amp;curOutboxes_i), receivers_i(&amp;curInboxes_i),
<a name="l00154"></a>00154            notices_i()
<a name="l00155"></a>00155       {}
<a name="l00156"></a>00156 
<a name="l00160"></a><a class="code" href="classmaxsum_1_1_post_office.html#c0374d46e0190d3722296f342bd8644c">00160</a>       <span class="keywordtype">void</span> <a class="code" href="classmaxsum_1_1_post_office.html#c0374d46e0190d3722296f342bd8644c" title="Removes all messages and edges from this postoffice.">clear</a>()
<a name="l00161"></a>00161       {
<a name="l00162"></a>00162          curOutboxes_i.clear();
<a name="l00163"></a>00163          prevOutboxes_i.clear();
<a name="l00164"></a>00164          curInboxes_i.clear();
<a name="l00165"></a>00165          prevInboxes_i.clear();
<a name="l00166"></a>00166          <span class="keywordflow">while</span>(!notices_i.empty())
<a name="l00167"></a>00167          {
<a name="l00168"></a>00168             notices_i.pop();
<a name="l00169"></a>00169          }
<a name="l00170"></a>00170       }
<a name="l00171"></a>00171 
<a name="l00176"></a><a class="code" href="classmaxsum_1_1_post_office.html#bb01ae6b147ea907ae01b862d5cbb095">00176</a>       <a class="code" href="classmaxsum_1_1util_1_1_ref_map.html" title="This class provides a read only wrapper around an existing map, such as that provided...">OutMsgMap</a> <a class="code" href="classmaxsum_1_1_post_office.html#bb01ae6b147ea907ae01b862d5cbb095" title="Returns the current set of output messages for a given sender.">curOutMsgs</a>(Sender s)
<a name="l00177"></a>00177       {
<a name="l00178"></a>00178          <span class="keyword">typename</span> OutboxMap::iterator pos = curOutboxes_i.find(s);
<a name="l00179"></a>00179          <span class="keywordflow">if</span>(curOutboxes_i.end()==pos)
<a name="l00180"></a>00180          {
<a name="l00181"></a>00181             <span class="keywordflow">throw</span> <a class="code" href="classmaxsum_1_1_unknown_address_exception.html" title="Exception thrown when a maxsum::PostOffice does not recognise the ID of a Sender...">UnknownAddressException</a>(<span class="stringliteral">"curOutMsgs"</span>,<span class="stringliteral">"Unknown sender."</span>);
<a name="l00182"></a>00182          }
<a name="l00183"></a>00183          <span class="keywordflow">return</span> <a class="code" href="classmaxsum_1_1_post_office.html#2aeb8127cbe14bac2c31fa8170d9d388" title="Map of Receivers to Messages for a specific Sender.">OutMsgMap</a>(pos-&gt;second);
<a name="l00184"></a>00184       }
<a name="l00185"></a>00185 
<a name="l00190"></a><a class="code" href="classmaxsum_1_1_post_office.html#da7d6b081c192c0bcd2cfd54b2ac9249">00190</a>       <a class="code" href="classmaxsum_1_1util_1_1_ref_map.html" title="This class provides a read only wrapper around an existing map, such as that provided...">OutMsgMap</a> <a class="code" href="classmaxsum_1_1_post_office.html#da7d6b081c192c0bcd2cfd54b2ac9249" title="Returns the previous set of output messages for a given sender.">prevOutMsgs</a>(Sender s)
<a name="l00191"></a>00191       {
<a name="l00192"></a>00192          <span class="keyword">typename</span> OutboxMap::iterator pos = prevOutboxes_i.find(s);
<a name="l00193"></a>00193          <span class="keywordflow">if</span>(prevOutboxes_i.end()==pos)
<a name="l00194"></a>00194          {
<a name="l00195"></a>00195             <span class="keywordflow">throw</span> <a class="code" href="classmaxsum_1_1_unknown_address_exception.html" title="Exception thrown when a maxsum::PostOffice does not recognise the ID of a Sender...">UnknownAddressException</a>(<span class="stringliteral">"prevOutMsgs"</span>,<span class="stringliteral">"Unknown sender."</span>);
<a name="l00196"></a>00196          }
<a name="l00197"></a>00197          <span class="keywordflow">return</span> <a class="code" href="classmaxsum_1_1_post_office.html#2aeb8127cbe14bac2c31fa8170d9d388" title="Map of Receivers to Messages for a specific Sender.">OutMsgMap</a>(pos-&gt;second);
<a name="l00198"></a>00198       }
<a name="l00199"></a>00199 
<a name="l00204"></a><a class="code" href="classmaxsum_1_1_post_office.html#f88a79ab5d3fbd3ebc1f61ba4d559755">00204</a>       <a class="code" href="classmaxsum_1_1util_1_1_ref_map.html" title="This class provides a read only wrapper around an existing map, such as that provided...">InMsgMap</a> <a class="code" href="classmaxsum_1_1_post_office.html#f88a79ab5d3fbd3ebc1f61ba4d559755" title="Returns the current set of input messages for a given receiver.">curInMsgs</a>(Receiver r)
<a name="l00205"></a>00205       {
<a name="l00206"></a>00206          <span class="keyword">typename</span> InboxMap::iterator pos = curInboxes_i.find(r);
<a name="l00207"></a>00207          <span class="keywordflow">if</span>(curInboxes_i.end()==pos)
<a name="l00208"></a>00208          {
<a name="l00209"></a>00209             <span class="keywordflow">throw</span> <a class="code" href="classmaxsum_1_1_unknown_address_exception.html" title="Exception thrown when a maxsum::PostOffice does not recognise the ID of a Sender...">UnknownAddressException</a>(<span class="stringliteral">"curInMsgs"</span>,<span class="stringliteral">"Unknown receiver."</span>);
<a name="l00210"></a>00210          }
<a name="l00211"></a>00211          <span class="keywordflow">return</span> <a class="code" href="classmaxsum_1_1_post_office.html#6d206af548f7f7e3bbce714c10afdc15" title="Map of Senders to Messages for a specific Receivers.">InMsgMap</a>(pos-&gt;second);
<a name="l00212"></a>00212       }
<a name="l00213"></a>00213 
<a name="l00218"></a><a class="code" href="classmaxsum_1_1_post_office.html#27e29f87ee5d184ed47e4fa770ba0836">00218</a>       <a class="code" href="classmaxsum_1_1util_1_1_ref_map.html" title="This class provides a read only wrapper around an existing map, such as that provided...">InMsgMap</a> <a class="code" href="classmaxsum_1_1_post_office.html#27e29f87ee5d184ed47e4fa770ba0836" title="Returns the previous set of input messages for a given receiver.">prevInMsgs</a>(Receiver r)
<a name="l00219"></a>00219       {
<a name="l00220"></a>00220          <span class="keyword">typename</span> InboxMap::iterator pos = prevInboxes_i.find(r);
<a name="l00221"></a>00221          <span class="keywordflow">if</span>(prevInboxes_i.end()==pos)
<a name="l00222"></a>00222          {
<a name="l00223"></a>00223             <span class="keywordflow">throw</span> <a class="code" href="classmaxsum_1_1_unknown_address_exception.html" title="Exception thrown when a maxsum::PostOffice does not recognise the ID of a Sender...">UnknownAddressException</a>(<span class="stringliteral">"prevInMsgs"</span>,<span class="stringliteral">"Unknown receiver."</span>);
<a name="l00224"></a>00224          }
<a name="l00225"></a>00225          <span class="keywordflow">return</span> <a class="code" href="classmaxsum_1_1_post_office.html#6d206af548f7f7e3bbce714c10afdc15" title="Map of Senders to Messages for a specific Receivers.">InMsgMap</a>(pos-&gt;second);
<a name="l00226"></a>00226       }
<a name="l00227"></a>00227 
<a name="l00231"></a><a class="code" href="classmaxsum_1_1_post_office.html#d7acb44d4859f417e78bbd33d56e6da7">00231</a>       <span class="keywordtype">bool</span> <a class="code" href="classmaxsum_1_1_post_office.html#d7acb44d4859f417e78bbd33d56e6da7" title="Returns true if any receivers have new mail.">newMail</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> !notices_i.empty(); }
<a name="l00232"></a>00232 
<a name="l00237"></a><a class="code" href="classmaxsum_1_1_post_office.html#4f7dacdac2d8b76d93ab7c68fa5c2cf7">00237</a>       <span class="keywordtype">void</span> <a class="code" href="classmaxsum_1_1_post_office.html#4f7dacdac2d8b76d93ab7c68fa5c2cf7" title="Notifies a receiver that they have new mail.">notify</a>(Receiver r) { notices_i.push(r); }
<a name="l00238"></a>00238 
<a name="l00242"></a><a class="code" href="classmaxsum_1_1_post_office.html#beabcdd005395148a7a965d972423d70">00242</a>       <span class="keywordtype">void</span> <a class="code" href="classmaxsum_1_1_post_office.html#beabcdd005395148a7a965d972423d70" title="Notifies all receivers that they have new mail.">notifyAll</a>()
<a name="l00243"></a>00243       {
<a name="l00244"></a>00244          <span class="keywordflow">while</span>(!notices_i.empty())
<a name="l00245"></a>00245          {
<a name="l00246"></a>00246             notices_i.pop();
<a name="l00247"></a>00247          }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249          <span class="keyword">typedef</span> <span class="keyword">typename</span> <a class="code" href="classmaxsum_1_1util_1_1_key_set_1_1const__iterator.html" title="Iterator type that allows read-only access to the keys of the underlying map.">util::KeySet&lt;InboxMap&gt;::const_iterator</a> Iterator;
<a name="l00250"></a>00250          <span class="keywordflow">for</span>(Iterator it=receivers_i.<a class="code" href="classmaxsum_1_1util_1_1_key_set.html#33a49785738439739b5e1fc9dd189033" title="Returns an iterator to the beginning of the key set.">begin</a>(); it!=receivers_i.<a class="code" href="classmaxsum_1_1util_1_1_key_set.html#26062e0e3e9fa6ada876836460b30ce9" title="Returns an iterator to the end of the key set.">end</a>(); ++it)
<a name="l00251"></a>00251          {
<a name="l00252"></a>00252             <a class="code" href="classmaxsum_1_1_post_office.html#4f7dacdac2d8b76d93ab7c68fa5c2cf7" title="Notifies a receiver that they have new mail.">notify</a>(*it);
<a name="l00253"></a>00253          }
<a name="l00254"></a>00254       }
<a name="l00255"></a>00255 
<a name="l00260"></a><a class="code" href="classmaxsum_1_1_post_office.html#c8fca48d31c4a6accf7786b3bcea130f">00260</a>       <span class="keywordtype">int</span> <a class="code" href="classmaxsum_1_1_post_office.html#c8fca48d31c4a6accf7786b3bcea130f" title="Returns the number of receivers who are currently notified to check their mail.">noticeCount</a>()<span class="keyword"> const</span>
<a name="l00261"></a>00261 <span class="keyword">      </span>{
<a name="l00262"></a>00262          <span class="keywordflow">return</span> notices_i.size();
<a name="l00263"></a>00263       }
<a name="l00264"></a>00264 
<a name="l00274"></a><a class="code" href="classmaxsum_1_1_post_office.html#555b273abb421ad73ca6327ee34ce35c">00274</a>       Receiver <a class="code" href="classmaxsum_1_1_post_office.html#555b273abb421ad73ca6327ee34ce35c" title="Returns the identity of the next receiver who has new mail, and removes their identity...">popNotice</a>()
<a name="l00275"></a>00275       {
<a name="l00276"></a>00276          <span class="keywordflow">if</span>(notices_i.empty())
<a name="l00277"></a>00277          {
<a name="l00278"></a>00278             <span class="keywordflow">throw</span> <a class="code" href="classmaxsum_1_1_empty_notice_exception.html" title="Exception thrown by PostOffice::popNotice when there are no active notices.">EmptyNoticeException</a>(<span class="stringliteral">"popNotice()"</span>,
<a name="l00279"></a>00279                   <span class="stringliteral">"Tried to pop from empty notice queue."</span>);
<a name="l00280"></a>00280          }
<a name="l00281"></a>00281          Receiver result = notices_i.front();
<a name="l00282"></a>00282          notices_i.pop();
<a name="l00283"></a>00283          <span class="keywordflow">return</span> result;
<a name="l00284"></a>00284       }
<a name="l00285"></a>00285 
<a name="l00291"></a><a class="code" href="classmaxsum_1_1_post_office.html#31775e5758a5faaf6ecbea9966c5e622">00291</a>       <span class="keywordtype">void</span> <a class="code" href="classmaxsum_1_1_post_office.html#31775e5758a5faaf6ecbea9966c5e622" title="Swaps the current messages from a specified sender with their previous ones.">swapOutBoxes</a>(Sender s)
<a name="l00292"></a>00292       {
<a name="l00293"></a>00293          <span class="comment">//*********************************************************************</span>
<a name="l00294"></a>00294          <span class="comment">// If this sender is not registered, then there is nothing to do</span>
<a name="l00295"></a>00295          <span class="comment">//*********************************************************************</span>
<a name="l00296"></a>00296          <span class="keyword">typename</span> OutboxMap::iterator curOutPos = curOutboxes_i.find(s);
<a name="l00297"></a>00297          <span class="keywordflow">if</span>(curOutboxes_i.end()==curOutPos)
<a name="l00298"></a>00298          {
<a name="l00299"></a>00299             <span class="keywordflow">return</span>;
<a name="l00300"></a>00300          }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302          <span class="comment">//*********************************************************************</span>
<a name="l00303"></a>00303          <span class="comment">// Otherwise swap the list of outboxes for this sender in one go.</span>
<a name="l00304"></a>00304          <span class="comment">//*********************************************************************</span>
<a name="l00305"></a>00305          prevOutboxes_i[s].swap(curOutPos-&gt;second);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307          <span class="comment">//*********************************************************************</span>
<a name="l00308"></a>00308          <span class="comment">// Inbox pointers need the be swapped individually</span>
<a name="l00309"></a>00309          <span class="comment">//*********************************************************************</span>
<a name="l00310"></a>00310          <span class="keywordflow">for</span>(<span class="keyword">typename</span> InboxMap::iterator curIt=curInboxes_i.begin();
<a name="l00311"></a>00311                curIt!=curInboxes_i.end(); ++curIt)
<a name="l00312"></a>00312          {
<a name="l00313"></a>00313             <span class="comment">//******************************************************************</span>
<a name="l00314"></a>00314             <span class="comment">// If the current receiver is not related to this sender, continue</span>
<a name="l00315"></a>00315             <span class="comment">// to the next receiver.</span>
<a name="l00316"></a>00316             <span class="comment">//******************************************************************</span>
<a name="l00317"></a>00317             PrivInMsgIt curMsgPos = curIt-&gt;second.find(s);
<a name="l00318"></a>00318             <span class="keywordflow">if</span>(curIt-&gt;second.end()==curMsgPos)
<a name="l00319"></a>00319             {
<a name="l00320"></a>00320                <span class="keywordflow">continue</span>;
<a name="l00321"></a>00321             }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323             <span class="comment">//******************************************************************</span>
<a name="l00324"></a>00324             <span class="comment">// Otherwise swap the current and previous in message pointers.</span>
<a name="l00325"></a>00325             <span class="comment">//******************************************************************</span>
<a name="l00326"></a>00326             Message*&amp; prevPtr = prevInboxes_i[curIt-&gt;first][s];
<a name="l00327"></a>00327             Message*&amp;  curPtr = curMsgPos-&gt;second;
<a name="l00328"></a>00328             Message*   tmpPtr = prevPtr;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330             prevPtr = curPtr;
<a name="l00331"></a>00331              curPtr = tmpPtr;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333          } <span class="comment">// for loop</span>
<a name="l00334"></a>00334 
<a name="l00335"></a>00335       } <span class="comment">// swapOutBoxes</span>
<a name="l00336"></a>00336 
<a name="l00344"></a><a class="code" href="classmaxsum_1_1_post_office.html#00c987b93cc34be6b386ad415f349b5d">00344</a>       <span class="keywordtype">void</span> <a class="code" href="classmaxsum_1_1_post_office.html#00c987b93cc34be6b386ad415f349b5d" title="Adds an edge between a specified sender and receiver.">addEdge</a>(Sender s, Receiver r)
<a name="l00345"></a>00345       {
<a name="l00346"></a>00346          <a class="code" href="classmaxsum_1_1_post_office.html#00c987b93cc34be6b386ad415f349b5d" title="Adds an edge between a specified sender and receiver.">addEdge</a>(s,r,Message());
<a name="l00347"></a>00347       }
<a name="l00348"></a>00348 
<a name="l00357"></a><a class="code" href="classmaxsum_1_1_post_office.html#5941bd5c306ecaac0481244e12e51e6f">00357</a>       <span class="keywordtype">void</span> <a class="code" href="classmaxsum_1_1_post_office.html#00c987b93cc34be6b386ad415f349b5d" title="Adds an edge between a specified sender and receiver.">addEdge</a>(Sender s, Receiver r, <span class="keyword">const</span> Message&amp; msgVal)
<a name="l00358"></a>00358       {
<a name="l00359"></a>00359          <span class="comment">//*********************************************************************</span>
<a name="l00360"></a>00360          <span class="comment">// If we have a message already, then we're done.</span>
<a name="l00361"></a>00361          <span class="comment">//*********************************************************************</span>
<a name="l00362"></a>00362          PrivOutMsgMap&amp; <a class="code" href="classmaxsum_1_1_post_office.html#bb01ae6b147ea907ae01b862d5cbb095" title="Returns the current set of output messages for a given sender.">curOutMsgs</a> = curOutboxes_i[s];
<a name="l00363"></a>00363          Message*&amp; pCurOutMsg = curOutMsgs[r];
<a name="l00364"></a>00364          <span class="keywordflow">if</span>(0!=pCurOutMsg)
<a name="l00365"></a>00365          {
<a name="l00366"></a>00366             <span class="keywordflow">return</span>;
<a name="l00367"></a>00367          }
<a name="l00368"></a>00368 
<a name="l00369"></a>00369          <span class="comment">//*********************************************************************</span>
<a name="l00370"></a>00370          <span class="comment">// Retrieve all other message pointers for this sender-receiver pair.</span>
<a name="l00371"></a>00371          <span class="comment">//*********************************************************************</span>
<a name="l00372"></a>00372          PrivInMsgMap&amp; <a class="code" href="classmaxsum_1_1_post_office.html#f88a79ab5d3fbd3ebc1f61ba4d559755" title="Returns the current set of input messages for a given receiver.">curInMsgs</a> = curInboxes_i[r];
<a name="l00373"></a>00373          PrivInMsgMap&amp; <a class="code" href="classmaxsum_1_1_post_office.html#27e29f87ee5d184ed47e4fa770ba0836" title="Returns the previous set of input messages for a given receiver.">prevInMsgs</a> = prevInboxes_i[r];
<a name="l00374"></a>00374          PrivOutMsgMap&amp; <a class="code" href="classmaxsum_1_1_post_office.html#da7d6b081c192c0bcd2cfd54b2ac9249" title="Returns the previous set of output messages for a given sender.">prevOutMsgs</a> = prevOutboxes_i[s];
<a name="l00375"></a>00375 
<a name="l00376"></a>00376          Message*&amp; pCurInMsg = curInMsgs[s];
<a name="l00377"></a>00377          Message*&amp; pPrevInMsg = prevInMsgs[s];
<a name="l00378"></a>00378          Message*&amp; pPrevOutMsg = prevOutMsgs[r];
<a name="l00379"></a>00379 
<a name="l00380"></a>00380          <span class="comment">//*********************************************************************</span>
<a name="l00381"></a>00381          <span class="comment">// Make sure that all message pointers for this sender receiver</span>
<a name="l00382"></a>00382          <span class="comment">// pair are consistent.</span>
<a name="l00383"></a>00383          <span class="comment">//*********************************************************************</span>
<a name="l00384"></a>00384          assert(pCurInMsg==pCurOutMsg);
<a name="l00385"></a>00385          assert(pPrevInMsg==pPrevOutMsg);
<a name="l00386"></a>00386          assert( (0==pCurInMsg) == (pCurInMsg==pPrevInMsg) );
<a name="l00387"></a>00387          assert( (0==pCurOutMsg) == (pCurOutMsg==pPrevOutMsg) );
<a name="l00388"></a>00388 
<a name="l00389"></a>00389          <span class="comment">//*********************************************************************</span>
<a name="l00390"></a>00390          <span class="comment">// Otherwise create new current and previous messages and stick</span>
<a name="l00391"></a>00391          <span class="comment">// then in the relevent lists.</span>
<a name="l00392"></a>00392          <span class="comment">//*********************************************************************</span>
<a name="l00393"></a>00393          pCurOutMsg = <span class="keyword">new</span> Message(msgVal);
<a name="l00394"></a>00394          pPrevOutMsg = <span class="keyword">new</span> Message(msgVal);
<a name="l00395"></a>00395          pCurInMsg = pCurOutMsg;
<a name="l00396"></a>00396          pPrevInMsg = pPrevOutMsg;
<a name="l00397"></a>00397 
<a name="l00398"></a>00398       } <span class="comment">// addEdge</span>
<a name="l00399"></a>00399 
<a name="l00407"></a><a class="code" href="classmaxsum_1_1_post_office.html#e703e93d67afb92e7318be2ad93ec8c5">00407</a>       <span class="keywordtype">void</span> <a class="code" href="classmaxsum_1_1_post_office.html#e703e93d67afb92e7318be2ad93ec8c5" title="Removes an edge between a specified sender and receiver.">removeEdge</a>(Sender s, Receiver r)
<a name="l00408"></a>00408       {
<a name="l00409"></a>00409          <span class="comment">//*********************************************************************</span>
<a name="l00410"></a>00410          <span class="comment">// If the sender edge does not exist, then this edge cannot exist,</span>
<a name="l00411"></a>00411          <span class="comment">// therefore, we're done.</span>
<a name="l00412"></a>00412          <span class="comment">//*********************************************************************</span>
<a name="l00413"></a>00413          <span class="keyword">typename</span> OutboxMap::iterator curOutboxPos  = curOutboxes_i.find(s);
<a name="l00414"></a>00414          <span class="keywordflow">if</span>(curOutboxes_i.end()==curOutboxPos)
<a name="l00415"></a>00415          {
<a name="l00416"></a>00416             <span class="keywordflow">return</span>;
<a name="l00417"></a>00417          }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419          <span class="comment">//*********************************************************************</span>
<a name="l00420"></a>00420          <span class="comment">// If this sender exits, but is not connected to specified receiver</span>
<a name="l00421"></a>00421          <span class="comment">// then we are also done.</span>
<a name="l00422"></a>00422          <span class="comment">//*********************************************************************</span>
<a name="l00423"></a>00423          PrivOutMsgMap&amp; <a class="code" href="classmaxsum_1_1_post_office.html#bb01ae6b147ea907ae01b862d5cbb095" title="Returns the current set of output messages for a given sender.">curOutMsgs</a> = curOutboxPos-&gt;second;
<a name="l00424"></a>00424          PrivOutMsgIt curOutMsgPos = curOutMsgs.find(r);
<a name="l00425"></a>00425          <span class="keywordflow">if</span>(curOutMsgs.end()==curOutMsgPos)
<a name="l00426"></a>00426          {
<a name="l00427"></a>00427             <span class="keywordflow">return</span>;
<a name="l00428"></a>00428          }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430          <span class="comment">//*********************************************************************</span>
<a name="l00431"></a>00431          <span class="comment">// Free allocated memory for the current and previous messages.</span>
<a name="l00432"></a>00432          <span class="comment">// Only need to do this for outboxes, because inboxes point to the</span>
<a name="l00433"></a>00433          <span class="comment">// same messages.</span>
<a name="l00434"></a>00434          <span class="comment">//*********************************************************************</span>
<a name="l00435"></a>00435          PrivOutMsgMap&amp; <a class="code" href="classmaxsum_1_1_post_office.html#da7d6b081c192c0bcd2cfd54b2ac9249" title="Returns the previous set of output messages for a given sender.">prevOutMsgs</a> = prevOutboxes_i[s];
<a name="l00436"></a>00436          Message*&amp; pCurOutMsg = curOutMsgPos-&gt;second;
<a name="l00437"></a>00437          PrivOutMsgIt prevOutMsgPos = prevOutMsgs.find(r);
<a name="l00438"></a>00438          assert(prevOutMsgs.end()!=prevOutMsgPos); <span class="comment">// should never happen.</span>
<a name="l00439"></a>00439          Message*&amp; pPrevOutMsg = prevOutMsgPos-&gt;second;
<a name="l00440"></a>00440          <span class="keyword">delete</span> pCurOutMsg;
<a name="l00441"></a>00441          <span class="keyword">delete</span> pPrevOutMsg;
<a name="l00442"></a>00442          pCurOutMsg=0;
<a name="l00443"></a>00443          pPrevOutMsg=0;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445          <span class="comment">//*********************************************************************</span>
<a name="l00446"></a>00446          <span class="comment">// Remove all relevant map enteries.</span>
<a name="l00447"></a>00447          <span class="comment">// For efficiency, we use the outbox iterators because we already</span>
<a name="l00448"></a>00448          <span class="comment">// have them.</span>
<a name="l00449"></a>00449          <span class="comment">//*********************************************************************</span>
<a name="l00450"></a>00450          curOutMsgs.erase(curOutMsgPos);
<a name="l00451"></a>00451          prevOutMsgs.erase(prevOutMsgPos);
<a name="l00452"></a>00452          curInboxes_i[r].erase(s);
<a name="l00453"></a>00453          prevInboxes_i[r].erase(s);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455          <span class="comment">//*********************************************************************</span>
<a name="l00456"></a>00456          <span class="comment">// If the sender no longer has any edges, delete it.</span>
<a name="l00457"></a>00457          <span class="comment">//*********************************************************************</span>
<a name="l00458"></a>00458          <span class="keywordflow">if</span>(curOutboxes_i[s].empty())
<a name="l00459"></a>00459          {
<a name="l00460"></a>00460             curOutboxes_i.erase(s);
<a name="l00461"></a>00461          }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463          <span class="comment">//*********************************************************************</span>
<a name="l00464"></a>00464          <span class="comment">// Likewise, if the receiver no longer has any edges, delete it too.</span>
<a name="l00465"></a>00465          <span class="comment">//*********************************************************************</span>
<a name="l00466"></a>00466          <span class="keywordflow">if</span>(curInboxes_i[r].empty())
<a name="l00467"></a>00467          {
<a name="l00468"></a>00468             curInboxes_i.erase(r);
<a name="l00469"></a>00469          }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471       } <span class="comment">// removeEdge</span>
<a name="l00472"></a>00472 
<a name="l00476"></a><a class="code" href="classmaxsum_1_1_post_office.html#b6cb1622333229ce8ba60243769791b1">00476</a>       <span class="keywordtype">bool</span> <a class="code" href="classmaxsum_1_1_post_office.html#b6cb1622333229ce8ba60243769791b1" title="Returns true if a specified sender is registered with this postoffice.">hasSender</a>(Sender <span class="keywordtype">id</span>)<span class="keyword"> const</span>
<a name="l00477"></a>00477 <span class="keyword">      </span>{
<a name="l00478"></a>00478          <span class="keywordflow">return</span> senders_i.<a class="code" href="classmaxsum_1_1util_1_1_key_set.html#fa82a0c84f8d63f5bed09686c45f8cbb" title="Returns true if the specified key is in this set.">contains</a>(<span class="keywordtype">id</span>);
<a name="l00479"></a>00479       }
<a name="l00480"></a>00480 
<a name="l00485"></a><a class="code" href="classmaxsum_1_1_post_office.html#6e04966f081f37bc0bcb554929db6865">00485</a>       <span class="keywordtype">bool</span> <a class="code" href="classmaxsum_1_1_post_office.html#6e04966f081f37bc0bcb554929db6865" title="Returns true if a specified receiver is registered with this postoffice.">hasReceiver</a>(Receiver <span class="keywordtype">id</span>)<span class="keyword"> const</span>
<a name="l00486"></a>00486 <span class="keyword">      </span>{
<a name="l00487"></a>00487          <span class="keywordflow">return</span> receivers_i.<a class="code" href="classmaxsum_1_1util_1_1_key_set.html#fa82a0c84f8d63f5bed09686c45f8cbb" title="Returns true if the specified key is in this set.">contains</a>(<span class="keywordtype">id</span>);
<a name="l00488"></a>00488       }
<a name="l00489"></a>00489 
<a name="l00497"></a><a class="code" href="classmaxsum_1_1_post_office.html#9df4c8433ad1e592317b44bdcbae571e">00497</a>       <span class="keywordtype">bool</span> <a class="code" href="classmaxsum_1_1_post_office.html#9df4c8433ad1e592317b44bdcbae571e" title="Returns true if a specified sender and receiver are connected.">hasEdge</a>(Sender s, Receiver r)<span class="keyword"> const</span>
<a name="l00498"></a>00498 <span class="keyword">      </span>{
<a name="l00499"></a>00499          <span class="comment">//*********************************************************************</span>
<a name="l00500"></a>00500          <span class="comment">// If the sender edge does not exist, then this edge cannot exist,</span>
<a name="l00501"></a>00501          <span class="comment">// therefore, we're done.</span>
<a name="l00502"></a>00502          <span class="comment">//*********************************************************************</span>
<a name="l00503"></a>00503          <span class="keyword">typename</span> OutboxMap::const_iterator curOutboxPos =curOutboxes_i.find(s);
<a name="l00504"></a>00504          <span class="keywordflow">if</span>(curOutboxes_i.end()==curOutboxPos)
<a name="l00505"></a>00505          {
<a name="l00506"></a>00506             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00507"></a>00507          }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509          <span class="comment">//*********************************************************************</span>
<a name="l00510"></a>00510          <span class="comment">// If this sender exits, but is not connected to specified receiver</span>
<a name="l00511"></a>00511          <span class="comment">// then we are also done.</span>
<a name="l00512"></a>00512          <span class="comment">//*********************************************************************</span>
<a name="l00513"></a>00513          <span class="keyword">const</span> PrivOutMsgMap&amp; <a class="code" href="classmaxsum_1_1_post_office.html#bb01ae6b147ea907ae01b862d5cbb095" title="Returns the current set of output messages for a given sender.">curOutMsgs</a> = curOutboxPos-&gt;second;
<a name="l00514"></a>00514          <span class="keyword">typename</span> PrivOutMsgMap::const_iterator curOutMsgPos
<a name="l00515"></a>00515             = curOutMsgs.<a class="code" href="classmaxsum_1_1util_1_1_ref_map.html#15c7a5c1084a03bb726d15f701eb4443" title="Tries to find the value for a given key in this map.">find</a>(r);
<a name="l00516"></a>00516 
<a name="l00517"></a>00517          <span class="keywordflow">if</span>(curOutMsgs.end()==curOutMsgPos)
<a name="l00518"></a>00518          {
<a name="l00519"></a>00519             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00520"></a>00520          }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522          <span class="comment">//*********************************************************************</span>
<a name="l00523"></a>00523          <span class="comment">// If we get this far, the edge must exist, so we return true.</span>
<a name="l00524"></a>00524          <span class="comment">//*********************************************************************</span>
<a name="l00525"></a>00525          <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527       } <span class="comment">// hasEdge</span>
<a name="l00528"></a>00528 
<a name="l00533"></a><a class="code" href="classmaxsum_1_1_post_office.html#31b4956d2fe506dfaee4d81f559ed54d">00533</a>       <span class="keywordtype">int</span> <a class="code" href="classmaxsum_1_1_post_office.html#31b4956d2fe506dfaee4d81f559ed54d" title="Returns the number of edges (routes between sender&amp;#39;s and receivers) registered...">numOfEdges</a>()<span class="keyword"> const</span>
<a name="l00534"></a>00534 <span class="keyword">      </span>{
<a name="l00535"></a>00535          <span class="comment">//*********************************************************************</span>
<a name="l00536"></a>00536          <span class="comment">// Count the number of edges for each sender</span>
<a name="l00537"></a>00537          <span class="comment">//*********************************************************************</span>
<a name="l00538"></a>00538          <span class="keywordtype">int</span> edgeCount = 0;
<a name="l00539"></a>00539          <span class="keywordflow">for</span>(<span class="keyword">typename</span> OutboxMap::const_iterator it=curOutboxes_i.begin();
<a name="l00540"></a>00540                it!=curOutboxes_i.end(); ++it)
<a name="l00541"></a>00541          {
<a name="l00542"></a>00542             edgeCount += it-&gt;second.size();
<a name="l00543"></a>00543          }
<a name="l00544"></a>00544          <span class="keywordflow">return</span> edgeCount;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546       } <span class="comment">// numOfEdges</span>
<a name="l00547"></a>00547 
<a name="l00551"></a><a class="code" href="classmaxsum_1_1_post_office.html#944ca1f7aa46c3fd15254e7bcc03d4aa">00551</a>       <span class="keywordtype">int</span> <a class="code" href="classmaxsum_1_1_post_office.html#944ca1f7aa46c3fd15254e7bcc03d4aa" title="Returns the number of Sender&amp;#39;s registered with this PostOffice.">numOfSenders</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> senders_i.<a class="code" href="classmaxsum_1_1util_1_1_key_set.html#53eb5348e863a081b3212358d18f157f" title="Returns the size of the underlying map.">size</a>(); }
<a name="l00552"></a>00552 
<a name="l00556"></a><a class="code" href="classmaxsum_1_1_post_office.html#f32ad6a492fa3ec260df9cfa46bb390a">00556</a>       <span class="keywordtype">int</span> <a class="code" href="classmaxsum_1_1_post_office.html#f32ad6a492fa3ec260df9cfa46bb390a" title="Returns the number of Receiver&amp;#39;s registered with this PostOffice.">numOfReceivers</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> receivers_i.<a class="code" href="classmaxsum_1_1util_1_1_key_set.html#53eb5348e863a081b3212358d18f157f" title="Returns the size of the underlying map.">size</a>(); }
<a name="l00557"></a>00557 
<a name="l00574"></a><a class="code" href="classmaxsum_1_1_post_office.html#20cba88e8e13739960740c6f5ab59cc0">00574</a>       <a class="code" href="classmaxsum_1_1util_1_1_key_set_1_1const__iterator.html" title="Iterator type that allows read-only access to the keys of the underlying map.">SenderIt</a> <a class="code" href="classmaxsum_1_1_post_office.html#20cba88e8e13739960740c6f5ab59cc0" title="Returns iterator to the beginning of the Sender set.">senderBegin</a>()<span class="keyword"> const</span>
<a name="l00575"></a>00575 <span class="keyword">      </span>{
<a name="l00576"></a>00576          <span class="keywordflow">return</span> senders_i.<a class="code" href="classmaxsum_1_1util_1_1_key_set.html#33a49785738439739b5e1fc9dd189033" title="Returns an iterator to the beginning of the key set.">begin</a>();
<a name="l00577"></a>00577       }
<a name="l00578"></a>00578 
<a name="l00595"></a><a class="code" href="classmaxsum_1_1_post_office.html#75b196eb2d1583afba048670a5817694">00595</a>       <a class="code" href="classmaxsum_1_1util_1_1_key_set_1_1const__iterator.html" title="Iterator type that allows read-only access to the keys of the underlying map.">SenderIt</a> <a class="code" href="classmaxsum_1_1_post_office.html#75b196eb2d1583afba048670a5817694" title="Returns iterator to the beginning of the Sender set.">senderEnd</a>()<span class="keyword"> const</span>
<a name="l00596"></a>00596 <span class="keyword">      </span>{
<a name="l00597"></a>00597          <span class="keywordflow">return</span> senders_i.<a class="code" href="classmaxsum_1_1util_1_1_key_set.html#26062e0e3e9fa6ada876836460b30ce9" title="Returns an iterator to the end of the key set.">end</a>();
<a name="l00598"></a>00598       }
<a name="l00599"></a>00599 
<a name="l00616"></a><a class="code" href="classmaxsum_1_1_post_office.html#a54a0bc4b8d1d341c98ad6dd77163912">00616</a>       <a class="code" href="classmaxsum_1_1util_1_1_key_set_1_1const__iterator.html" title="Iterator type that allows read-only access to the keys of the underlying map.">ReceiverIt</a> <a class="code" href="classmaxsum_1_1_post_office.html#a54a0bc4b8d1d341c98ad6dd77163912" title="Returns iterator to the beginning of the Receiver set.">receiverBegin</a>()
<a name="l00617"></a>00617       {
<a name="l00618"></a>00618          <span class="keywordflow">return</span> receivers_i.<a class="code" href="classmaxsum_1_1util_1_1_key_set.html#33a49785738439739b5e1fc9dd189033" title="Returns an iterator to the beginning of the key set.">begin</a>();
<a name="l00619"></a>00619       }
<a name="l00620"></a>00620 
<a name="l00637"></a><a class="code" href="classmaxsum_1_1_post_office.html#a87674d559e3c3dd2681a119ca0ed029">00637</a>       <a class="code" href="classmaxsum_1_1util_1_1_key_set_1_1const__iterator.html" title="Iterator type that allows read-only access to the keys of the underlying map.">ReceiverIt</a> <a class="code" href="classmaxsum_1_1_post_office.html#a87674d559e3c3dd2681a119ca0ed029" title="Returns iterator to the beginning of the Receiver set.">receiverEnd</a>()
<a name="l00638"></a>00638       {
<a name="l00639"></a>00639          <span class="keywordflow">return</span> receivers_i.<a class="code" href="classmaxsum_1_1util_1_1_key_set.html#26062e0e3e9fa6ada876836460b30ce9" title="Returns an iterator to the end of the key set.">end</a>();
<a name="l00640"></a>00640       }
<a name="l00641"></a>00641 
<a name="l00647"></a><a class="code" href="classmaxsum_1_1_post_office.html#933517942e64d42da28131ec684c7ba9">00647</a>       <span class="keyword">virtual</span> <a class="code" href="classmaxsum_1_1_post_office.html#933517942e64d42da28131ec684c7ba9" title="Destructor frees all resources used by this PostOffice.">~PostOffice</a>()
<a name="l00648"></a>00648       {
<a name="l00649"></a>00649          <span class="comment">//********************************************************************</span>
<a name="l00650"></a>00650          <span class="comment">// Free all current messages by iterating through the outboxes.</span>
<a name="l00651"></a>00651          <span class="comment">// We do not need to free inboxes, because these point to the same</span>
<a name="l00652"></a>00652          <span class="comment">// messages, which should only be freed once.</span>
<a name="l00653"></a>00653          <span class="comment">//********************************************************************</span>
<a name="l00654"></a>00654          <span class="keywordflow">for</span>(<span class="keyword">typename</span> OutboxMap::iterator boxIt=curOutboxes_i.begin();
<a name="l00655"></a>00655                boxIt!=curOutboxes_i.end(); ++boxIt)
<a name="l00656"></a>00656          {
<a name="l00657"></a>00657             <span class="keywordflow">for</span>(PrivOutMsgIt msgIt=boxIt-&gt;second.begin();
<a name="l00658"></a>00658                   msgIt!=boxIt-&gt;second.end(); ++msgIt)
<a name="l00659"></a>00659             {
<a name="l00660"></a>00660                <span class="keyword">delete</span> msgIt-&gt;second;
<a name="l00661"></a>00661             }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663          } <span class="comment">// outer for loop</span>
<a name="l00664"></a>00664 
<a name="l00665"></a>00665          <span class="comment">//********************************************************************</span>
<a name="l00666"></a>00666          <span class="comment">// Free all previous messages by iterating through the outboxes.</span>
<a name="l00667"></a>00667          <span class="comment">// We do not need to free inboxes, because these point to the same</span>
<a name="l00668"></a>00668          <span class="comment">// messages, which should only be freed once.</span>
<a name="l00669"></a>00669          <span class="comment">//********************************************************************</span>
<a name="l00670"></a>00670          <span class="keywordflow">for</span>(<span class="keyword">typename</span> OutboxMap::iterator boxIt=prevOutboxes_i.begin();
<a name="l00671"></a>00671                boxIt!=prevOutboxes_i.end(); ++boxIt)
<a name="l00672"></a>00672          {
<a name="l00673"></a>00673             <span class="keywordflow">for</span>(PrivOutMsgIt msgIt=boxIt-&gt;second.begin();
<a name="l00674"></a>00674                   msgIt!=boxIt-&gt;second.end(); ++msgIt)
<a name="l00675"></a>00675             {
<a name="l00676"></a>00676                <span class="keyword">delete</span> msgIt-&gt;second;
<a name="l00677"></a>00677             }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679          } <span class="comment">// outer for loop</span>
<a name="l00680"></a>00680 
<a name="l00681"></a>00681       } <span class="comment">// destructor</span>
<a name="l00682"></a>00682 
<a name="l00683"></a>00683    }; <span class="comment">// class PostOffice</span>
<a name="l00684"></a>00684 
<a name="l00688"></a><a class="code" href="namespacemaxsum.html#7e7cfade9f4781ff4a5d74397b584980">00688</a>    <span class="keyword">typedef</span> <a class="code" href="classmaxsum_1_1_post_office.html">PostOffice&lt;VarID,FactorID&gt;</a> <a class="code" href="classmaxsum_1_1_post_office.html">V2FPostOffice</a>;
<a name="l00689"></a>00689 
<a name="l00693"></a><a class="code" href="namespacemaxsum.html#6cc54b9fce21b60cf66dca62e5f06fc3">00693</a>    <span class="keyword">typedef</span> <a class="code" href="classmaxsum_1_1_post_office.html">PostOffice&lt;FactorID,VarID&gt;</a> <a class="code" href="classmaxsum_1_1_post_office.html">F2VPostOffice</a>;
<a name="l00694"></a>00694 
<a name="l00698"></a><a class="code" href="namespacemaxsum.html#ba3b3b89155eeec99cff8f330fe9948b">00698</a>    <span class="keyword">typedef</span> <a class="code" href="classmaxsum_1_1_post_office.html" title="Class used to store and manage messages sent between factor graph nodes.">PostOffice&lt;FactorID,FactorID&gt;</a> <a class="code" href="classmaxsum_1_1_post_office.html" title="Class used to store and manage messages sent between factor graph nodes.">F2FPostOffice</a>;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 } <span class="comment">// namespace maxsum</span>
<a name="l00701"></a>00701 
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 
<a name="l00704"></a>00704 <span class="preprocessor">#endif // MAXSUM_UTIL_POSTOFFICE_H</span>
<a name="l00705"></a>00705 <span class="preprocessor"></span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Jul 30 17:00:02 2012 for Max-Sum by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.9 </small></address>
</body>
</html>
